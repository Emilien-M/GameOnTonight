@inject IAuthService AuthService
@inject NavigationManager Navigation
@implements IDisposable

<div class="tabbar">
    <NavLink class="tab" href="/filter/findForm" Match="NavLinkMatch.All">
        <span class="icon" aria-hidden="true"><LucideIcon Name="funnel" /></span>
        <span class="label">Filtrer</span>
    </NavLink>

    <NavLink class="tab" href="/library">
        <span class="icon" aria-hidden="true"><LucideIcon Name="library" /></span>
        <span class="label">Ludothèque</span>
    </NavLink>

    <NavLink class="tab" href="/groups">
        <span class="icon" aria-hidden="true"><LucideIcon Name="users" /></span>
        <span class="label">Groupes</span>
    </NavLink>

    <NavLink class="tab" href="/history">
        <span class="icon" aria-hidden="true"><LucideIcon Name="history" /></span>
        <span class="label">Historique</span>
    </NavLink>

    <NavLink class="tab" href="/statistics">
        <span class="icon" aria-hidden="true"><LucideIcon Name="chart-pie" /></span>
        <span class="label">Stats</span>
    </NavLink>

    <NavLink class="tab" href="@(_isAuthenticated ? "profile" : "login")">
        <span class="icon" aria-hidden="true"><LucideIcon Name="user" /></span>
        <span class="label">Profil</span>
    </NavLink>
</div>

@code {
    private bool _isAuthenticated;

    protected override async Task OnInitializedAsync()
    {
        _isAuthenticated = await AuthService.IsAuthenticatedAsync();
        Navigation.LocationChanged += OnLocationChanged;
        Navigation.NavigateTo("filter/findForm");
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        InvokeAsync(async () =>
        {
            _isAuthenticated = await AuthService.IsAuthenticatedAsync();
            StateHasChanged();
        });
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }
}